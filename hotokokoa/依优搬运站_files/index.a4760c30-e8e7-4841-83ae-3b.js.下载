!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}(e)||function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_unsupportedIterableToArray(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,F=function(){};return{s:F,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function isString(e){return"[object String]"===Object.prototype.toString.call(e)}function isPlainObject(e){var t,r=Object.prototype.hasOwnProperty;if(!e||"object"!==_typeof(e)||e.nodeType||function isWindow(e){var t=Object.prototype.toString.call(e);return"[object global]"===t||"[object Window]"===t||"[object DOMWindow]"===t}(e))return!1;try{if(e.constructor&&!r.call(e,"constructor")&&!r.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(t in e);return void 0===t||r.call(e,t)}var e=/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/,t=/^\/[A-z0-9-_+].*/,r=[window.location.hostname,"music.163.com","look.163.com","wave.163.com","moyi.163.com","k.163.com","crush.163.com"];function getHostPath(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=window.location.href,r=t.indexOf("?"),n=r>0?t.substring(0,r):t;return n?e?window.encodeURIComponent(n):n:""}var n=new function Injector(){this.reqList={},this._open=void 0,this._send=void 0,this._setRequestHeader=void 0,this.options={},this._sender_url="",this.injectDomains=_toConsumableArray(r)||[],this.onRemove=function(){window.XMLHttpRequest&&(window.XMLHttpRequest.prototype.open=this._open,window.XMLHttpRequest.prototype.send=this._send,window.XMLHttpRequest.prototype.setRequestHeader=this._setRequestHeader,this._open=void 0,this._send=void 0,this._setRequestHeader=void 0)},this.setOption=function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=r||{};var n=this.options.domains,o=void 0===n?"":n;((o=o||"").split(",")||[]).forEach((function(r){""!==r&&e.test(r)&&!t.injectDomains.includes(r)&&t.injectDomains.push(r)}));var i=this.options.isEncodeURIComponent,a=void 0!==i&&i;this._sender_url=getHostPath(a)},this.canInject=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=e;return t.test(e)&&(r="".concat(window.location.origin).concat(e)),r&&this.injectDomains.filter((function(e){return r.indexOf(e)>=0})).length>0},this.injectAjax=function(){if(this.options.enableXHRInject){var e=this;r=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(e,t){var n=this;return n._url=t,r.apply(this,arguments)},t=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(r){var n=this.onreadystatechange;this.onreadystatechange=function(){n&&n.apply(this,arguments)}.bind(this);try{e.canInject(this._url)&&this.setRequestHeader(e.options.injectAPIHeader,"100_".concat(e._sender_url||window.location.href))}catch(e){}return t.call(this,r)}}var t,r},this.injectFetch=function(){if(this.options.enableFetchInject){var e=window.fetch;if(!e)return;var t=this;window.fetch=function prevFetch(r,n){var o=function getUniqueID(){return Math.random().toString(36).substring(2,8)}();t.reqList={},t.reqList[o]={};var i=t.reqList[o]||{},a=[],c="",s="GET",p=null;if(isString(r)?(s=n.method||"GET",c=r,p=n.headers||null):(s=r.method||"GET",c=r.url,p=r.headers),a=c.split("?"),i.id=o,i.method=s,i.requestHeader=p,i.url=c,i.name=a.shift()||"",i.name=i.name.replace(new RegExp("[/]*$"),"").split("/").pop()||"","[object Headers]"===Object.prototype.toString.call(p)){i.requestHeader={};var u,l=_createForOfIteratorHelper(p.entries());try{for(l.s();!(u=l.n()).done;){var f=u.value;i.requestHeader[f[0]]=f[1]}}catch(e){l.e(e)}finally{l.f()}}else i.requestHeader=p;if(a.length>0){i.name+="?".concat(a),i.getData={};var d,y=_createForOfIteratorHelper(a=(a=a.join("?")).split("&"));try{for(y.s();!(d=y.n()).done;){var h=d.value;h=h.split("="),i.getData[h[0]]=h[1]}}catch(e){y.e(e)}finally{y.f()}}if("POST"===i.method)if(isString(r))if(isString(n.body)){var b=n.body.split("&");i.postData={};var j,v=_createForOfIteratorHelper(b);try{for(v.s();!(j=v.n()).done;){var m=j.value;m=m.split("="),i.postData[m[0]]=m[1]}}catch(e){v.e(e)}finally{v.f()}}else isPlainObject(n.body)?i.postData=n.body:i.postData="[object Object]";else i.postData="[object Object]";i.startTime||(i.startTime=+new Date);try{var _="100_".concat(t._sender_url||window.location.href);if(""!==t.options.injectAPIHeader&&t.canInject(c)&&isString(r))if("[object Headers]"===Object.prototype.toString.call(p))"function"==typeof p.append&&p.append(t.options.injectAPIHeader,_);else{var w=n||{};"object"!==_typeof(w.headers)||null===w.headers?w.headers=_defineProperty({},t.options.injectAPIHeader,_):w.headers=_objectSpread2(_objectSpread2({},w.headers||{}),{},_defineProperty({},t.options.injectAPIHeader,_)),n=w}}catch(e){}return e(c,n).then((function(e){return e.clone().text().then((function(t){var r=e.headers.get("content-type"),n=t,o="";if(r.includes("application/json"))try{n=JSON.parse(t),o="json"}catch(e){}else r.includes("text/html")&&(o="text");i.endTime=+new Date,i.costTime=i.endTime-(i.startTime||i.endTime),i.status=e.status,i.header={};var a,c=_createForOfIteratorHelper(e.headers.entries());try{for(c.s();!(a=c.n()).done;){var s=a.value;i.header[s[0]]=s[1]}}catch(e){c.e(e)}finally{c.f()}return i.response=n,i.readyState=4,i.responseType=o,n})).finally((function(){})),e}))}}}},o=n;window.__MUSIC_APIInjector__=function APIInjector(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var t=e||{};if(t.apiInject=t.apiInject||{},t.apiInject.enable){var r=!!t.apiInject.enableXHRInject,n=!!t.apiInject.enableFetchInject;o.setOption(_objectSpread2(_objectSpread2({},t.apiInject),{},{env:e.env||"",domains:e.apiInject.domains||""})),r&&o.injectAjax(t.apiInject),n&&o.injectFetch(t.apiInject)}}catch(e){console.log("__MUSIC_APIInjector__",e)}}}));
